{
  "version": 3,
  "sources": ["src/app/components/otp/otp.component.ts", "src/app/components/otp/otp.component.html"],
  "sourcesContent": ["import {\r\n  AfterViewInit,\r\n  Component,\r\n  ElementRef,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  QueryList,\r\n  ViewChildren,\r\n  forwardRef,\r\n  inject,\r\n} from '@angular/core';\r\nimport {\r\n  ControlValueAccessor,\r\n  FormArray,\r\n  FormControl,\r\n  NG_VALIDATORS,\r\n  NG_VALUE_ACCESSOR,\r\n  ReactiveFormsModule,\r\n  Validator,\r\n  Validators,\r\n} from '@angular/forms';\r\nimport {\r\n  ERROR_MESSAGES,\r\n  VALIDATION_ERROR_MESSAGES,\r\n} from '../form-error/validation-error-messages.token';\r\nimport { Subscription } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'ca-otp',\r\n  standalone: true,\r\n  imports: [ReactiveFormsModule],\r\n  templateUrl: './otp.component.html',\r\n  styleUrl: './otp.component.css',\r\n  providers: [\r\n    {\r\n      provide: NG_VALUE_ACCESSOR,\r\n      useExisting: OtpComponent,\r\n      multi: true,\r\n    },\r\n    {\r\n      provide: NG_VALIDATORS,\r\n      useExisting: OtpComponent,\r\n      multi: true,\r\n    },\r\n  ],\r\n})\r\nexport class OtpComponent\r\n  implements OnInit, AfterViewInit, ControlValueAccessor, OnDestroy, Validator\r\n{\r\n  #size = 0;\r\n  otpControl!: FormControl;\r\n  inputs!: FormArray<any>;\r\n  otpCode: string[] = [];\r\n\r\n  errorsMap = inject(VALIDATION_ERROR_MESSAGES);\r\n\r\n  @Input() set size(n: number) {\r\n    this.#size = n;\r\n  }\r\n  @ViewChildren('input', { read: ElementRef })\r\n  inputRefs!: QueryList<ElementRef>;\r\n\r\n  onTouched?: () => void;\r\n  onChange?: (value: string) => void;\r\n\r\n  valueChangesSub?: Subscription;\r\n\r\n  ngOnInit() {\r\n    this.inputs = this.createFields();\r\n    this.otpControl = new FormControl(null, [\r\n      Validators.required,\r\n      Validators.minLength(this.#size),\r\n      Validators.maxLength(this.#size),\r\n    ]);\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    (<HTMLInputElement>this.inputRefs.first.nativeElement).focus();\r\n  }\r\n\r\n  createFields() {\r\n    let controls: FormArray<FormControl> = new FormArray<FormControl>([]);\r\n\r\n    for (let i = 0; i < this.#size; i++) {\r\n      controls.push(new FormControl(''));\r\n    }\r\n\r\n    return controls;\r\n  }\r\n\r\n  writeValue(value: string) {\r\n    if (!value) {\r\n      return;\r\n    }\r\n\r\n    if (value.length > this.#size) {\r\n      value = value.slice(0, this.#size);\r\n    }\r\n\r\n    this.otpControl.setValue(value);\r\n    this.inputs.setValue(new Array(...value.split('')));\r\n  }\r\n\r\n  registerOnChange(fn: any) {\r\n    this.valueChangesSub = this.otpControl.valueChanges.subscribe(fn);\r\n  }\r\n\r\n  registerOnTouched(fn: any) {\r\n    this.valueChangesSub = this.otpControl.valueChanges.subscribe(fn);\r\n  }\r\n\r\n  handleInput(event: Event) {\r\n    const elem = event.target as HTMLInputElement;\r\n    const isDigit = /\\d/.test(elem.value);\r\n\r\n    if (!isDigit) {\r\n      elem.value = '';\r\n      return;\r\n    }\r\n\r\n    const next = elem.nextElementSibling;\r\n\r\n    if (elem.value.length > 1) {\r\n      elem.value = elem.value.charAt(0);\r\n      return;\r\n    }\r\n\r\n    if (next) {\r\n      (next as HTMLInputElement).focus();\r\n    }\r\n    this.setNewControlValue();\r\n  }\r\n\r\n  handleKeyUp(event: KeyboardEvent) {\r\n    const target = event.target as HTMLInputElement;\r\n    const isDelete =\r\n      event.key.toLowerCase() === 'backspace' ||\r\n      event.key.toLowerCase() === 'delete';\r\n\r\n    if (isDelete) {\r\n      const prev = target.previousElementSibling as HTMLInputElement;\r\n\r\n      if (prev) {\r\n        prev.select();\r\n      }\r\n    }\r\n\r\n    this.setNewControlValue();\r\n  }\r\n\r\n  handlePaste(event: ClipboardEvent, idx: number) {\r\n    event.preventDefault();\r\n\r\n    if (idx !== 0) return;\r\n\r\n    const data = event.clipboardData?.getData('text');\r\n    const isDigits = new RegExp(`/\\d${this.#size}/`).test(data || '');\r\n\r\n    if (!data && !isDigits) return;\r\n\r\n    this.inputRefs.forEach((_, i) => {\r\n      this.inputs.at(i).setValue(data![i]);\r\n    });\r\n\r\n    this.setNewControlValue();\r\n    (<HTMLInputElement>this.inputRefs.last.nativeElement).focus();\r\n  }\r\n\r\n  setNewControlValue() {\r\n    this.otpControl.setValue(this.inputs.value.join(''));\r\n  }\r\n\r\n  validate(): Record<string, boolean> | null {\r\n    const { errors } = this.otpControl;\r\n\r\n    if (errors && errors['required']) {\r\n      return { required: true };\r\n    }\r\n\r\n    if (errors && errors['minlength']) {\r\n      return { minLength: true };\r\n    }\r\n\r\n    if (errors && errors['maxlength']) {\r\n      return { maxLength: true };\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.valueChangesSub?.unsubscribe();\r\n  }\r\n}\r\n", "<div class=\"flex justify-between\">\r\n  @for (input of inputs.controls; track $index) {\r\n  <input\r\n    #input\r\n    type=\"number\"\r\n    maxlength=\"1\"\r\n    max=\"9\"\r\n    inputmode=\"numeric\"\r\n    class=\"rounded text-center\"\r\n    [formControl]=\"$any(input)\"\r\n    [attr.autocomplete]=\"$index === 0 ? 'one-time-password' : null\"\r\n    (input)=\"handleInput($event)\"\r\n    (keyup)=\"handleKeyUp($event)\"\r\n    (paste)=\"handlePaste($event, $index)\"\r\n  />\r\n  }\r\n</div>\r\n"],
  "mappings": "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",
  "names": ["\u0275\u0275elementStart", "\u0275\u0275listener", "$event", "\u0275\u0275restoreView", "_r1", "ctx_r1", "\u0275\u0275nextContext", "\u0275\u0275resetView", "handleInput", "handleKeyUp", "$index_r3", "$index", "handlePaste", "\u0275\u0275elementEnd", "\u0275\u0275property", "input_r4", "OtpComponent", "_size", "constructor", "__privateAdd", "__privateSet", "otpCode", "errorsMap", "inject", "VALIDATION_ERROR_MESSAGES", "size", "n", "ngOnInit", "inputs", "createFields", "otpControl", "FormControl", "Validators", "required", "minLength", "__privateGet", "maxLength", "ngAfterViewInit", "inputRefs", "first", "nativeElement", "focus", "controls", "FormArray", "i", "push", "writeValue", "value", "length", "slice", "setValue", "Array", "split", "registerOnChange", "fn", "valueChangesSub", "valueChanges", "subscribe", "registerOnTouched", "event", "elem", "target", "test", "next", "nextElementSibling", "charAt", "setNewControlValue", "key", "toLowerCase", "prev", "previousElementSibling", "select", "idx", "preventDefault", "data", "clipboardData", "getData", "isDigits", "RegExp", "forEach", "_", "at", "last", "join", "validate", "errors", "ngOnDestroy", "unsubscribe", "selectors", "viewQuery", "rf", "ctx", "ElementRef", "provide", "NG_VALUE_ACCESSOR", "useExisting", "multi", "NG_VALIDATORS", "\u0275\u0275StandaloneFeature", "decls", "vars", "consts", "template", "\u0275\u0275repeaterCreate", "OtpComponent_For_2_Template", "\u0275\u0275repeaterTrackByIndex", "\u0275\u0275advance", "\u0275\u0275repeater", "ReactiveFormsModule", "DefaultValueAccessor", "NumberValueAccessor", "NgControlStatus", "MaxLengthValidator", "MaxValidator", "FormControlDirective", "styles", "_OtpComponent"]
}
