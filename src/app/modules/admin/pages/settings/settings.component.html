<!-- System Configuration & Settings Management -->
<div class="settings-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-info">
        <h1>System Configuration</h1>
        <p class="header-subtitle">Comprehensive platform administration and settings management</p>
      </div>
      <div class="header-actions">
        <button class="btn btn-secondary" (click)="loadSystemStatus()">
          <i class="icon-refresh"></i> Refresh Status
        </button>
      </div>
    </div>
  </div>

  <div class="settings-layout">
    <!-- Sidebar Navigation -->
    <div class="settings-sidebar">
      <nav class="sidebar-nav">
        <ul class="nav-list">
          <li *ngFor="let section of sections" class="nav-item">
            <button 
              class="nav-link"
              [class.active]="activeSection === section.id"
              (click)="setActiveSection(section.id)">
              <i [class]="'icon-' + section.icon"></i>
              <span>{{ section.label }}</span>
            </button>
          </li>
        </ul>
      </nav>
    </div>

    <!-- Main Content -->
    <div class="settings-content">
      
      <!-- System Overview Section -->
      <div class="content-section" *ngIf="activeSection === 'overview'">
        <div class="section-header">
          <h2>System Overview</h2>
          <p>Monitor overall system health and status</p>
        </div>

        <div class="status-grid" *ngIf="systemStatus">
          <!-- Platform Status -->
          <div class="status-card">
            <div class="card-header">
              <h3>Platform Status</h3>
              <span class="status-badge" [ngClass]="getStatusClass(systemStatus.platform.status)">
                {{ systemStatus.platform.status | titlecase }}
              </span>
            </div>
            <div class="card-content">
              <div class="status-info">
                <div class="info-item">
                  <span class="label">Uptime</span>
                  <span class="value">{{ systemStatus.platform.uptime }}%</span>
                </div>
                <div class="info-item">
                  <span class="label">Version</span>
                  <span class="value">{{ systemStatus.platform.version }}</span>
                </div>
                <div class="info-item">
                  <span class="label">Last Deployment</span>
                  <span class="value">{{ formatDate(systemStatus.platform.lastDeployment) }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Database Status -->
          <div class="status-card">
            <div class="card-header">
              <h3>Database</h3>
              <span class="status-badge" [ngClass]="getStatusClass(systemStatus.database.status)">
                {{ systemStatus.database.status | titlecase }}
              </span>
            </div>
            <div class="card-content">
              <div class="status-info">
                <div class="info-item">
                  <span class="label">Connections</span>
                  <span class="value">{{ systemStatus.database.connections }}/{{ systemStatus.database.maxConnections }}</span>
                </div>
                <div class="info-item">
                  <span class="label">Response Time</span>
                  <span class="value">{{ systemStatus.database.responseTime }}ms</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Storage Status -->
          <div class="status-card">
            <div class="card-header">
              <h3>Storage</h3>
              <span class="usage-indicator">{{ systemStatus.storage.usage }}%</span>
            </div>
            <div class="card-content">
              <div class="status-info">
                <div class="info-item">
                  <span class="label">Used</span>
                  <span class="value">{{ formatBytes(systemStatus.storage.used) }}</span>
                </div>
                <div class="info-item">
                  <span class="label">Total</span>
                  <span class="value">{{ formatBytes(systemStatus.storage.total) }}</span>
                </div>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="systemStatus.storage.usage"></div>
              </div>
            </div>
          </div>

          <!-- Notifications Status -->
          <div class="status-card">
            <div class="card-header">
              <h3>Notifications</h3>
              <span class="status-badge status-success">Active</span>
            </div>
            <div class="card-content">
              <div class="status-info">
                <div class="info-item">
                  <span class="label">Email Queue</span>
                  <span class="value">{{ systemStatus.notifications.emailQueue }}</span>
                </div>
                <div class="info-item">
                  <span class="label">SMS Queue</span>
                  <span class="value">{{ systemStatus.notifications.smsQueue }}</span>
                </div>
                <div class="info-item">
                  <span class="label">Failure Rate</span>
                  <span class="value">{{ systemStatus.notifications.failureRate }}%</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Platform Settings Section -->
      <div class="content-section" *ngIf="activeSection === 'general'">
        <div class="section-header">
          <h2>Platform Settings</h2>
          <p>Configure general platform settings and business rules</p>
        </div>

        <!-- Settings Tabs -->
        <div class="settings-tabs">
          <div class="tab-list">
            <button 
              *ngFor="let tab of settingsTabs"
              class="tab-button"
              [class.active]="activeSettingsTab === tab.id"
              (click)="setActiveSettingsTab(tab.id)">
              {{ tab.label }}
            </button>
          </div>

          <div class="tab-content" *ngIf="platformSettings">
            
            <!-- General Settings -->
            <div class="tab-pane" *ngIf="activeSettingsTab === 'general'">
              <div class="settings-form">
                <div class="form-grid">
                  <div class="form-group">
                    <label>Platform Name</label>
                    <input type="text" [(ngModel)]="platformSettings.general.platformName" class="form-control">
                  </div>
                  <div class="form-group">
                    <label>Company Name</label>
                    <input type="text" [(ngModel)]="platformSettings.general.companyName" class="form-control">
                  </div>
                  <div class="form-group">
                    <label>Support Email</label>
                    <input type="email" [(ngModel)]="platformSettings.general.supportEmail" class="form-control">
                  </div>
                  <div class="form-group">
                    <label>Support Phone</label>
                    <input type="text" [(ngModel)]="platformSettings.general.supportPhone" class="form-control">
                  </div>
                  <div class="form-group full-width">
                    <label>Platform Description</label>
                    <textarea [(ngModel)]="platformSettings.general.platformDescription" class="form-control" rows="3"></textarea>
                  </div>
                  <div class="form-group full-width">
                    <label>Address</label>
                    <textarea [(ngModel)]="platformSettings.general.address" class="form-control" rows="2"></textarea>
                  </div>
                </div>
              </div>
            </div>

            <!-- Business Rules -->
            <div class="tab-pane" *ngIf="activeSettingsTab === 'business'">
              <div class="settings-form">
                <h3>MGR Settings</h3>
                <div class="form-grid">
                  <div class="form-group">
                    <label>Minimum Contribution (NGN)</label>
                    <input type="number" [(ngModel)]="platformSettings.business.mgrSettings.minimumContribution" class="form-control">
                  </div>
                  <div class="form-group">
                    <label>Maximum Contribution (NGN)</label>
                    <input type="number" [(ngModel)]="platformSettings.business.mgrSettings.maximumContribution" class="form-control">
                  </div>
                  <div class="form-group">
                    <label>Processing Fee (%)</label>
                    <input type="number" step="0.1" [(ngModel)]="platformSettings.business.mgrSettings.processingFee" class="form-control">
                  </div>
                  <div class="form-group">
                    <label>Penalty Rate (%)</label>
                    <input type="number" step="0.1" [(ngModel)]="platformSettings.business.mgrSettings.penaltyRate" class="form-control">
                  </div>
                </div>

                <h3>Transaction Settings</h3>
                <div class="form-grid">
                  <div class="form-group">
                    <label>Daily Limit (NGN)</label>
                    <input type="number" [(ngModel)]="platformSettings.business.transactionSettings.dailyTransactionLimit" class="form-control">
                  </div>
                  <div class="form-group">
                    <label>Monthly Limit (NGN)</label>
                    <input type="number" [(ngModel)]="platformSettings.business.transactionSettings.monthlyTransactionLimit" class="form-control">
                  </div>
                  <div class="form-group">
                    <label>Withdrawal Fee (%)</label>
                    <input type="number" step="0.1" [(ngModel)]="platformSettings.business.transactionSettings.withdrawalFee" class="form-control">
                  </div>
                  <div class="form-group">
                    <label>Transfer Fee (NGN)</label>
                    <input type="number" [(ngModel)]="platformSettings.business.transactionSettings.transferFee" class="form-control">
                  </div>
                </div>
              </div>
            </div>

            <!-- Security Settings -->
            <div class="tab-pane" *ngIf="activeSettingsTab === 'security'">
              <div class="settings-form">
                <h3>Authentication</h3>
                <div class="form-grid">
                  <div class="form-group">
                    <label>Session Timeout (minutes)</label>
                    <input type="number" [(ngModel)]="platformSettings.security.authentication.sessionTimeout" class="form-control">
                  </div>
                  <div class="form-group">
                    <label>Max Login Attempts</label>
                    <input type="number" [(ngModel)]="platformSettings.security.authentication.maxLoginAttempts" class="form-control">
                  </div>
                  <div class="form-group">
                    <label>Password Min Length</label>
                    <input type="number" [(ngModel)]="platformSettings.security.authentication.passwordMinLength" class="form-control">
                  </div>
                  <div class="form-group">
                    <label class="checkbox-label">
                      <input type="checkbox" [(ngModel)]="platformSettings.security.authentication.twoFactorRequired">
                      <span>Require Two-Factor Authentication</span>
                    </label>
                  </div>
                </div>

                <h3>Risk Management</h3>
                <div class="form-grid">
                  <div class="form-group">
                    <label>Risk Threshold</label>
                    <input type="number" [(ngModel)]="platformSettings.security.riskManagement.transactionRiskThreshold" class="form-control">
                  </div>
                  <div class="form-group">
                    <label>Auto-Flag Above (NGN)</label>
                    <input type="number" [(ngModel)]="platformSettings.security.riskManagement.requireApprovalAbove" class="form-control">
                  </div>
                  <div class="form-group">
                    <label class="checkbox-label">
                      <input type="checkbox" [(ngModel)]="platformSettings.security.riskManagement.autoFlagTransactions">
                      <span>Auto-Flag Transactions</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Feature Settings -->
            <div class="tab-pane" *ngIf="activeSettingsTab === 'features'">
              <div class="settings-form">
                <h3>User Features</h3>
                <div class="checkbox-grid">
                  <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="platformSettings.features.userFeatures.allowRegistration">
                    <span>Allow User Registration</span>
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="platformSettings.features.userFeatures.emailVerificationRequired">
                    <span>Require Email Verification</span>
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="platformSettings.features.userFeatures.profileEditingEnabled">
                    <span>Allow Profile Editing</span>
                  </label>
                </div>

                <h3>Payment Features</h3>
                <div class="checkbox-grid">
                  <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="platformSettings.features.paymentFeatures.enableBankTransfer">
                    <span>Enable Bank Transfer</span>
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="platformSettings.features.paymentFeatures.enableCardPayment">
                    <span>Enable Card Payment</span>
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="platformSettings.features.paymentFeatures.enableWalletPayment">
                    <span>Enable Wallet Payment</span>
                  </label>
                </div>

                <h3>Platform Features</h3>
                <div class="checkbox-grid">
                  <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="platformSettings.features.platformFeatures.analyticsEnabled">
                    <span>Enable Analytics</span>
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="platformSettings.features.platformFeatures.supportChatEnabled">
                    <span>Enable Support Chat</span>
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="platformSettings.features.platformFeatures.maintenanceMode">
                    <span>Maintenance Mode</span>
                  </label>
                </div>
              </div>
            </div>

          </div>

          <!-- Save Button -->
          <div class="settings-actions">
            <button class="btn btn-primary" (click)="savePlatformSettings()" [disabled]="loading">
              <i class="icon-save" *ngIf="!loading"></i>
              <i class="icon-spinner" *ngIf="loading"></i>
              {{ loading ? 'Saving...' : 'Save Settings' }}
            </button>
          </div>
        </div>
      </div>

      <!-- Payment Gateways Section -->
      <div class="content-section" *ngIf="activeSection === 'gateways'">
        <div class="section-header">
          <h2>Payment Gateways</h2>
          <p>Configure and manage payment gateway integrations</p>
        </div>

        <div class="gateways-grid" *ngIf="!gatewaysLoading">
          <div class="gateway-card" *ngFor="let gateway of paymentGateways">
            <div class="card-header">
              <div class="gateway-info">
                <h3>{{ gateway.name }}</h3>
                <span class="gateway-type">{{ gateway.type | titlecase }}</span>
              </div>
              <div class="gateway-status">
                <span class="status-badge" [ngClass]="gateway.isActive ? 'status-success' : 'status-danger'">
                  {{ gateway.isActive ? 'Active' : 'Inactive' }}
                </span>
                <span class="uptime">{{ gateway.uptime }}% uptime</span>
              </div>
            </div>
            <div class="card-content">
              <div class="gateway-stats">
                <div class="stat-item">
                  <span class="label">Processing Time</span>
                  <span class="value">{{ gateway.processingTime }} min</span>
                </div>
                <div class="stat-item">
                  <span class="label">Fee Rate</span>
                  <span class="value">{{ gateway.feeStructure.percentage }}%</span>
                </div>
                <div class="stat-item">
                  <span class="label">Last Check</span>
                  <span class="value">{{ formatDate(gateway.lastStatusCheck) }}</span>
                </div>
              </div>
              <div class="gateway-actions">
                <button class="btn btn-sm btn-primary" (click)="openGatewayModal(gateway)">
                  <i class="icon-edit"></i> Configure
                </button>
                <button class="btn btn-sm btn-secondary" (click)="testGateway(gateway.id)">
                  <i class="icon-test"></i> Test
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Admin Users Section -->
      <div class="content-section" *ngIf="activeSection === 'admins'">
        <div class="section-header">
          <h2>Admin Users</h2>
          <p>Manage administrator accounts and permissions</p>
          <button class="btn btn-primary" (click)="openAdminModal()">
            <i class="icon-plus"></i> Add Admin
          </button>
        </div>

        <div class="admins-table" *ngIf="!adminsLoading">
          <table class="data-table">
            <thead>
              <tr>
                <th>Admin Details</th>
                <th>Role</th>
                <th>Permissions</th>
                <th>Last Login</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let admin of systemAdmins">
                <td>
                  <div class="admin-info">
                    <div class="admin-name">{{ admin.fullName }}</div>
                    <div class="admin-email">{{ admin.email }}</div>
                    <div class="admin-username">{{ admin.username }}</div>
                  </div>
                </td>
                <td>
                  <span class="role-badge" [ngClass]="getRoleClass(admin.role)">
                    {{ admin.role | titlecase }}
                  </span>
                </td>
                <td>
                  <div class="permissions-list">
                    <span *ngFor="let permission of admin.permissions.slice(0, 2)" class="permission-tag">
                      {{ permission }}
                    </span>
                    <span *ngIf="admin.permissions.length > 2" class="permission-count">
                      +{{ admin.permissions.length - 2 }} more
                    </span>
                  </div>
                </td>
                <td>{{ formatDate(admin.lastLogin) }}</td>
                <td>
                  <span class="status-badge" [ngClass]="admin.isActive ? 'status-success' : 'status-danger'">
                    {{ admin.isActive ? 'Active' : 'Inactive' }}
                  </span>
                </td>
                <td>
                  <div class="action-buttons">
                    <button class="btn btn-sm btn-primary" (click)="openAdminModal(admin)">
                      <i class="icon-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-danger" (click)="confirmDeleteAdmin(admin)" *ngIf="admin.role !== 'super_admin'">
                      <i class="icon-delete"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- System Logs Section -->
      <div class="content-section" *ngIf="activeSection === 'logs'">
        <div class="section-header">
          <h2>System Logs</h2>
          <p>Monitor system activities and security events</p>
        </div>

        <div class="logs-table" *ngIf="!logsLoading">
          <table class="data-table">
            <thead>
              <tr>
                <th>Timestamp</th>
                <th>Level</th>
                <th>Category</th>
                <th>Message</th>
                <th>IP Address</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let log of systemLogs">
                <td>{{ formatDate(log.timestamp) }}</td>
                <td>
                  <span class="log-level" [ngClass]="getLogLevelClass(log.level)">
                    {{ log.level | titlecase }}
                  </span>
                </td>
                <td>{{ log.category }}</td>
                <td>{{ log.message }}</td>
                <td>{{ log.ipAddress }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Maintenance Section -->
      <div class="content-section" *ngIf="activeSection === 'maintenance'">
        <div class="section-header">
          <h2>System Maintenance</h2>
          <p>Perform system maintenance and administrative operations</p>
        </div>

        <div class="maintenance-grid">
          <div class="maintenance-card">
            <div class="card-header">
              <h3>Cache Management</h3>
              <i class="icon-cache"></i>
            </div>
            <div class="card-content">
              <p>Clear system cache to improve performance and resolve issues.</p>
              <button class="btn btn-warning" (click)="clearCache()">
                <i class="icon-clear"></i> Clear Cache
              </button>
            </div>
          </div>

          <div class="maintenance-card">
            <div class="card-header">
              <h3>Database Optimization</h3>
              <i class="icon-database"></i>
            </div>
            <div class="card-content">
              <p>Optimize database tables and recover disk space.</p>
              <button class="btn btn-primary" (click)="optimizeDatabase()">
                <i class="icon-optimize"></i> Optimize Database
              </button>
            </div>
          </div>

          <div class="maintenance-card">
            <div class="card-header">
              <h3>Backup Management</h3>
              <i class="icon-backup"></i>
            </div>
            <div class="card-content">
              <p>Create manual backup of system data and configurations.</p>
              <button class="btn btn-success" (click)="createBackup()">
                <i class="icon-backup"></i> Create Backup
              </button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Gateway Configuration Modal -->
<div class="modal-overlay" *ngIf="showGatewayModal" (click)="closeGatewayModal()">
  <div class="modal-dialog" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Configure Payment Gateway</h3>
      <button class="modal-close" (click)="closeGatewayModal()">
        <i class="icon-close"></i>
      </button>
    </div>
    <div class="modal-content" *ngIf="selectedGateway">
      <div class="form-grid">
        <div class="form-group">
          <label>Gateway Name</label>
          <input type="text" [(ngModel)]="selectedGateway.name" class="form-control" readonly>
        </div>
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="selectedGateway.isActive">
            <span>Active</span>
          </label>
        </div>
        <div class="form-group">
          <label>Public Key</label>
          <input type="text" [(ngModel)]="selectedGateway.configuration.publicKey" class="form-control">
        </div>
        <div class="form-group">
          <label>Secret Key</label>
          <input type="password" [(ngModel)]="selectedGateway.configuration.secretKey" class="form-control">
        </div>
        <div class="form-group">
          <label>Fee Percentage</label>
          <input type="number" step="0.1" [(ngModel)]="selectedGateway.feeStructure.percentage" class="form-control">
        </div>
        <div class="form-group">
          <label>Flat Fee (NGN)</label>
          <input type="number" [(ngModel)]="selectedGateway.feeStructure.flatFee" class="form-control">
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeGatewayModal()">Cancel</button>
      <button class="btn btn-primary" (click)="saveGateway()">Save Configuration</button>
    </div>
  </div>
</div>

<!-- Admin User Modal -->
<div class="modal-overlay" *ngIf="showAdminModal" (click)="closeAdminModal()">
  <div class="modal-dialog" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ selectedAdmin ? 'Edit Admin User' : 'Create Admin User' }}</h3>
      <button class="modal-close" (click)="closeAdminModal()">
        <i class="icon-close"></i>
      </button>
    </div>
    <div class="modal-content">
      <div class="form-grid">
        <div class="form-group">
          <label>Username</label>
          <input type="text" [(ngModel)]="newAdmin.username" class="form-control">
        </div>
        <div class="form-group">
          <label>Full Name</label>
          <input type="text" [(ngModel)]="newAdmin.fullName" class="form-control">
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" [(ngModel)]="newAdmin.email" class="form-control">
        </div>
        <div class="form-group">
          <label>Role</label>
          <select [(ngModel)]="newAdmin.role" class="form-control">
            <option value="admin">Admin</option>
            <option value="moderator">Moderator</option>
            <option value="support">Support</option>
          </select>
        </div>
      </div>
      
      <div class="permissions-section">
        <h4>Permissions</h4>
        <div class="permissions-grid">
          <label *ngFor="let permission of availablePermissions" class="checkbox-label">
            <input type="checkbox" [checked]="hasPermission(permission.value)" (change)="togglePermission(permission.value)">
            <span>{{ permission.label }}</span>
          </label>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeAdminModal()">Cancel</button>
      <button class="btn btn-primary" (click)="saveAdmin()">{{ selectedAdmin ? 'Update' : 'Create' }} Admin</button>
    </div>
  </div>
</div>

<!-- Confirmation Modal -->
<div class="modal-overlay" *ngIf="showConfirmModal" (click)="closeConfirmModal()">
  <div class="modal-dialog modal-sm" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ confirmAction?.title }}</h3>
      <button class="modal-close" (click)="closeConfirmModal()">
        <i class="icon-close"></i>
      </button>
    </div>
    <div class="modal-content">
      <p>{{ confirmAction?.message }}</p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeConfirmModal()">Cancel</button>
      <button class="btn btn-danger" (click)="executeConfirmAction()">Confirm</button>
    </div>
  </div>
</div> 