<div class="bg-white rounded-lg p-8 shadow-sm mb-8">
  <h2 class="text-2xl font-medium mb-6">Create new plan</h2>
  
  <form [formGroup]="form" (ngSubmit)="handleSubmit()">
    <div class="mb-6">
      <label for="name" class="block text-gray-700 mb-2">Plan name <span class="text-purple-main">*</span></label>
      <input
        type="text"
        id="name"
        formControlName="name"
        placeholder="Name"
        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-main"
        [ngClass]="{
          'ng-touched ng-dirty border-red-500': isSubmitted && name.invalid
        }"
      />
      @if (isSubmitted && name.invalid) {
      <ca-form-error [errors]="name.errors" />
      }
    </div>

    <div class="mb-6">
      <label for="desc" class="block text-gray-700 mb-2">Short description <span class="text-purple-main">*</span></label>
      <input
        type="text"
        id="desc"
        formControlName="desc"
        placeholder="Short description"
        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-main"
        [ngClass]="{
          'ng-touched ng-dirty border-red-500': isSubmitted && desc.invalid
        }"
      />
      @if (isSubmitted && desc.invalid) {
      <ca-form-error [errors]="desc.errors" />
      }
    </div>

    <div class="mb-6">
      <label for="duration" class="block text-gray-700 mb-2">Duration <span class="text-purple-main">*</span></label>
      <div class="relative">
        <ng-select
          id="duration"
          formControlName="duration"
          [clearOnBackspace]="false"
          placeholder="Select duration"
          class="py-1 border border-gray-300 rounded-lg"
          [ngClass]="{
            'ng-touched ng-dirty border-red-500': isSubmitted && duration.invalid
          }"
        >
          @for (duration of durations; track $index) {
          <ng-option [value]="duration.id">{{ duration.name }}</ng-option>
          }
        </ng-select>
      </div>
      @if (isSubmitted && duration.invalid) {
      <ca-form-error [errors]="duration.errors" />
      }
    </div>

    <div class="mb-6">
      <label for="num-members" class="block text-gray-700 mb-2">Number of members <span class="text-purple-main">*</span></label>
      <input
        type="number"
        id="num-members"
        formControlName="number_of_members"
        placeholder="Number of members"
        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-main"
        [ngClass]="{
          'ng-touched ng-dirty border-red-500': isSubmitted && numberOfMembers.invalid
        }"
      />
      @if (isSubmitted && numberOfMembers.invalid) {
      <ca-form-error [errors]="numberOfMembers.errors" />
      }
    </div>

    <div class="mb-6">
      <label for="amount" class="block text-gray-700 mb-2">Amount <span class="text-purple-main">*</span></label>
      <input
        type="text"
        id="amount"
        formControlName="amount"
        placeholder="Enter amount"
        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-main"
        [ngClass]="{
          'ng-touched ng-dirty border-red-500': isSubmitted && amount.invalid
        }"
      />
      @if (isSubmitted && amount.invalid) {
      <ca-form-error [errors]="amount.errors" />
      }
    </div>

    <div class="mb-6">
      <label for="date" class="block text-gray-700 mb-2">Contribution Start Date <span class="text-purple-main">*</span></label>
      <div class="relative">
        <input
          id="date"
          type="text"
          formControlName="contribution_start_date"
          placeholder="18-05-2023"
          bsDatepicker
          #cdp="bsDatepicker"
          [minDate]="minContributionDate"
          [bsConfig]="{ isAnimated: true, dateInputFormat: 'DD-MM-YYYY' }"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-main"
          [ngClass]="{
            'ng-dirty ng-touched border-red-500': isSubmitted && startDate.invalid
          }"
        />
        <button type="button" (click)="cdp.show()" class="absolute right-3 top-1/2 transform -translate-y-1/2">
          <i class="ca-calendar text-[#5c5c5c]"></i>
        </button>
      </div>
      @if (isSubmitted && startDate.invalid) {
      <ca-form-error [errors]="startDate.errors" />
      }
    </div>

    <div class="mb-6">
      <label for="allocation-date" class="block text-gray-700 mb-2">Allocation Date <span class="text-purple-main">*</span></label>
      <div class="relative">
        <input
          id="allocation-date"
          type="text"
          formControlName="allocation_date"
          placeholder="18-05-2023"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-main"
          [ngClass]="{
            'ng-dirty ng-touched border-red-500': isSubmitted && allocationDate.invalid
          }"
        />
        <span class="absolute right-3 top-1/2 transform -translate-y-1/2">
          <i class="ca-calendar text-[#5c5c5c]"></i>
        </span>
      </div>
      @if (isSubmitted && allocationDate.invalid) {
      <ca-form-error [errors]="allocationDate.errors" />
      }
    </div>

    <div class="mb-6">
      <label for="allotment-type" class="block text-gray-700 mb-2">Allotment Type <span class="text-purple-main">*</span></label>
      <div class="relative">
        <ng-select
          id="allotment-type"
          placeholder="Select allotment type"
          class="py-1"
          [ngClass]="{
            'ng-touched ng-dirty border-red-500': isSubmitted && allotmentType.invalid
          }"
          (change)="selectAllotmentType()"
        >
          <ng-option value="manual">Manual</ng-option>
          <ng-option value="automatic">Automatic</ng-option>
        </ng-select>
      </div>
      @if (isSubmitted && allotmentType.invalid) {
      <ca-form-error [errors]="allotmentType.errors" />
      }
    </div>
    
    <!-- Only shown if allotment type is selected -->
    @if (selectedAllotmentType) {
    <div class="mb-6">
      <ca-allotment-type-card
        [allotmentType]="selectedAllotmentType"
        (allotmentTypeChange)="selectAllotmentType()"
      />
    </div>
    }

    <div class="mb-12">
      <div class="flex items-start gap-3">
        <input type="checkbox" id="subscribe" [formControl]="terms" class="mt-1" />
        <label class="text-sm text-gray-700" for="subscribe">
          I agree to Collo Africa MGR terms and conditions.
        </label>
      </div>
      @if (isSubmitted && terms.invalid) {
      <ca-form-error [errors]="terms.errors" />
      }
    </div>

    <div class="mb-4">
      <button
        class="w-full py-3 bg-purple-main text-white rounded-lg font-medium"
        type="submit"
        [disabled]="loading"
      >
        {{ loading ? 'Processing...' : 'Create plan' }}
      </button>
    </div>
  </form>
</div>
